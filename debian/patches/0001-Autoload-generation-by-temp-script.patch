From: "Igor B. Poretsky" <poretsky@mlbox.ru>
Date: Sun, 8 Jan 2023 18:14:51 +0300
Subject: Autoload generation by temp script

---
 Makefile | 18 +++++++++++-------
 1 file changed, 11 insertions(+), 7 deletions(-)

diff --git a/Makefile b/Makefile
index 41ef814..8081f5d 100644
--- a/Makefile
+++ b/Makefile
@@ -1,16 +1,20 @@
 .POSIX:
 EMACS = emacs
 
+autoload_generation_code = \
+(let ((make-backup-files nil) \
+      (generated-autoload-file (expand-file-name "youtube-dl-loaddefs.el"))) \
+  (update-file-autoloads "youtube-dl.el" t) \
+  (update-file-autoloads "youtube-dl-play.el" t) \
+  (update-file-autoloads "youtube-dl-view.el" t) \
+  (update-file-autoloads "youtube-dl-w3m.el" t))
+
 all: youtube-dl-loaddefs.el youtube-dl.elc youtube-dl-play.elc youtube-dl-view.elc youtube-dl-w3m.elc
 
 youtube-dl-loaddefs.el: youtube-dl.el youtube-dl-play.el youtube-dl-view.el youtube-dl-w3m.el
-	$(EMACS) -batch -Q --eval \
-		'(let ((make-backup-files nil) \
-		       (generated-autoload-file (expand-file-name "youtube-dl-loaddefs.el"))) \
-		   (update-file-autoloads "youtube-dl.el" t) \
-		   (update-file-autoloads "youtube-dl-play.el" t) \
-		   (update-file-autoloads "youtube-dl-view.el" t) \
-		   (update-file-autoloads "youtube-dl-w3m.el" t))'
+	echo '$(autoload_generation_code)' >temp-script.el
+	$(EMACS) -batch -Q -l temp-script.el
+	rm temp-script.el
 
 simulate: youtube-dl.elc
 	$(EMACS) -Q -L . -l tests/youtube-dl-simulate.el
